Country Currency & GDP API

This is a RESTful API that fetches country and currency data from external sources, calculates estimated GDP, and caches it in a MySQL database. It provides full CRUD operations and generates a dynamic summary image.

This project is built with Node.js, TypeScript, Express, Sequelize, and MySQL.

Features

Fetches data from restcountries.com and open.er-api.com.

Caches all data in a MySQL database.

Calculates estimated_gdp for each country with a random multiplier.

Generates a PNG summary image on refresh using sharp.

Provides robust error handling and standardized JSON responses.

Environment Variables

Create a .env file in the root of the project.

# Port for the server
PORT=8080

# Your MySQL connection string (e.g., from Railway)
# Format: mysql://USER:PASSWORD@HOST:PORT/DATABASE
DATABASE_URL="mysql://root:my_pass@my_host.railway.app:1234/railway"

# External API URLs
COUNTRIES_API_URL=[https://restcountries.com/v2/all?fields=name,capital,region,population,flag,currencies](https://restcountries.com/v2/all?fields=name,capital,region,population,flag,currencies)
RATES_API_URL=[https://open.er-api.com/v6/latest/USD](https://open.er-api.com/v6/latest/USD)


Setup & Installation

Clone the repository:

git clone [https://github.com/your-username/country-api.git](https://github.com/your-username/country-api.git)
cd country-api


Install dependencies (using Bun):

bun install


Set up the database:

This project is designed to connect to a cloud-hosted MySQL database (like on Railway).

Create a new MySQL service on your hosting provider.

Get the public connection URL (e.g., MYSQL_PUBLIC_URL) and paste it as the DATABASE_URL in your .env file.

Run the server (Development):

bun run dev


The server will start on http://localhost:8080 (or your PORT) and auto-restart on file changes.

Build and Run (Production):

bun run build   # Compiles TypeScript to ./dist
bun start       # Runs the compiled JavaScript


API Endpoints

All endpoints are prefixed with /api.

POST /countries/refresh

Fetches fresh data from all external APIs, recalculates all GDPs, and updates the database cache. This also regenerates the summary.png image.

Success Response (200):

{
  "message": "Cache refreshed successfully",
  "total_countries": 250,
  "last_refreshed_at": "2025-10-26T15:30:00.000Z"
}


Error Response (503):

{
  "error": "External data source unavailable",
  "details": "Could not fetch data from RestCountries API"
}


GET /countries

Retrieves a list of all countries from the database cache.

Query Parameters:

region (string): Filter by region (case-insensitive).

Example: /api/countries?region=Africa

currency (string): Filter by currency code (case-insensitive).

Example: /api/countries?currency=NGN

sort (string): Sorts the results.

Example: /api/countries?sort=gdp_desc (Default is name_asc)

Success Response (200):

[
  {
    "id": 1,
    "name": "Nigeria",
    "capital": "Abuja",
    "region": "Africa",
    "population": 206139589,
    "currency_code": "NGN",
    "exchange_rate": 1600.23,
    "estimated_gdp": 25767448125.2,
    "flag_url": "[https://flagcdn.com/ng.svg](https://flagcdn.com/ng.svg)",
    "last_refreshed_at": "2025-10-26T15:30:00.000Z"
  }
]


GET /countries/:name

Retrieves a single country by its name (case-insensitive).

Success Response (200):

{
  "id": 1,
  "name": "Nigeria",
  /* ... all other fields */
}


Error Response (404):

{ "error": "Country not found" }


DELETE /countries/:name

Deletes a single country from the database by its name (case-insensitive).

Success Response (204): No content.

Error Response (404):

{ "error": "Country not found" }


GET /status

Shows the total number of countries in the database and the timestamp of the last successful refresh.

Success Response (200):

{
  "id": 1,
  "total_countries": 250,
  "last_refreshed_at": "2025-10-26T15:30:00.000Z"
}


GET /countries/image

Serves the summary.png image generated by the last successful refresh.

Success Response (200): Returns the PNG image file.

Error Response (404):

{ "error": "Summary image not found" }
